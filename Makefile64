-include Makefile-common
CFLAGS64 = $(CFLAGS)

LDFLAGS64=$(LDFLAGS)

OBJS64=$(patsubst %,$(OBJDIR64)/%,$(OBJ_FILE_NAMES))

OBJDIR64 = obj64
DISTDIR64 = dist64

SHARE_LIBRARY_TARGET64 = $(DISTDIR64)/$(SHARE_LIBRARY_TARGET)

$(OBJDIR64)/%.o : %.c
	mkdir -p $(OBJDIR64); \
	mkdir -p $(DISTDIR64); \
	mkdir -p $(DEPDIR); \
	$(MAKEDEPEND); \
	sed -e 's/\(^[^:\.o \t]\)/$(OBJDIR64)\/\1/' < $*.d > $(DEPDIR)/$*.P; \
	sed -e 's/#.*//' -e 's/^[^:]*: *//' -e 's/ *\\$$//' -e '/^$$/ d' -e 's/$$/ :/' -e  's/\(^[^:.o \t]*\.o: .*\)/$(OBJDIR64)\/\1/' < $*.d >> $(DEPDIR)/$*.P; \
	$(COMPILE.c) -o $@ $<; \
	rm -f $*.d;

$(SHARE_LIBRARY_TARGET64): $(OBJS64)
	mkdir -p $(DISTDIR64); 
	$(CC) $(CFLAGS) -o $@ -shared $(OBJS64) 

$(DISTDIR64)/test: $(UNIT_TEST_SRC) $(SHARE_LIBRARY_TARGET64)
	$(CC) $(CFLAGS) $(LDFLAGS64) -Wl,-rpath=./dist64/  -DUNIT_TEST -o $@ $< $(SHARE_LIBRARY_TARGET64)

install64: $(SHARE_LIBRARY_TARGET64)
	mkdir -p $(INSTALL_PREFIX)/lib
	mkdir -p $(INSTALL_PREFIX)/include	
	mkdir -p $(INSTALL_PREFIX)/lib/pkgconfig
	cp $(SHARE_LIBRARY_TARGET64) $(INSTALL_PREFIX)/lib
	cp $(HEADER_FILE) $(INSTALL_PREFIX)/include
	cp $(PKGCONFIG_FILE) $(INSTALL_PREFIX)/lib/pkgconfig
	
.PHONY: run clean
run64: $(DISTDIR64)/test
	./$(DISTDIR64)/test
run: run64

clean: clean-common
	rm -rf $(OBJDIR64) $(SHARE_LIBRARY_TARGET64)
